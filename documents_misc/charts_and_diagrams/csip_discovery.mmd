%%{init: {'theme':'default'}}%%
flowchart TD
    Start([CSIS Discovery Start]) --> DiscoverService[Discover CSIS]
    
    DiscoverService --> ServiceFound{Service<br/>found?}
    
    ServiceFound -->|No| Error([Discovery Failed])
    ServiceFound -->|Yes| DiscoverChars[Discover characteristics:<br/>• SIRK<br/>• Size<br/>• Lock<br/>• Rank]
    
    DiscoverChars --> CharsFound{All required<br/>chars found?}
    
    CharsFound -->|No| Error
    CharsFound -->|Yes| ReadSIRK[Read SIRK value]
    
    ReadSIRK --> ValidateSIRK{SIRK<br/>valid?}
    
    ValidateSIRK -->|No| Error
    ValidateSIRK -->|Yes| ReadSize[Read Set Size]
    
    ReadSize --> ReadRank[Read Rank]
    
    ReadRank --> StoreInfo[Store set member info]
    
    StoreInfo --> Ready([CSIS Ready])
    
    style Start fill:#e1f5e1
    style Ready fill:#e1f5e1
    style Error fill:#ffe1e1
    style ServiceFound fill:#fff4e1
    style CharsFound fill:#fff4e1
    style ValidateSIRK fill:#fff4e1